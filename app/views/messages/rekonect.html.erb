<div class="reply-header">
  <div>
    <h1 class="reply-title">Peut-Ãªtre est-il temps de relancer la conversation avec :</h1>
  </div>
  <div class="reply-avatar-block">
    <% if @message.contact.photo.attached? %>
      <%= image_tag @message.contact.photo, class: "avatar-mobile ms-2" %>
    <% else %>
      <%= image_tag "default-avatar.png", class: "avatar-mobile" %>
    <% end %>
    <span class="reply-contact-name"><%= @message.contact.name %></span>
  </div>
</div>

<!-- Historique -->
<% if @summary.present? %>
  <div class="msg-bubble-pink mb-2">
    <div class="reply-block-title d-flex justify-content-between align-items-center" onclick="toggleBlock('history-messages-block', 'icon-history')">
      <div>
        Voici un rÃ©sumÃ© de vos derniers Ã©changes :
      </div>
      <span id="icon-history">ðŸ”»</span> <!-- FlÃ¨che vers le bas -->
    </div>

    <div id="history-messages-block" class="slide-toggle non-open">
        <div class="card-mobile msg-inner-bubble mb-1">
          <div class="message-content"><%= @summary %></div>
        </div>
    </div>
  </div>
<% end %>

<!-- Dernier message envoyÃ© par l'utilisateur et restÃ© sans rÃ©ponse -->
<div class="msg-bubble-pink mb-3">
  <div class="reply-block-title d-flex justify-content-between align-items-center" onclick="toggleBlock('last-message-block', 'icon-last')">
    <span>Dernier message de ta part</span>
    <span id="icon-last">ðŸ”»</span> <!-- FlÃ¨che vers le bas -->
  </div>
  <div id="last-message-block" class="slide-toggle non-open">
    <div class="card-mobile msg-inner-bubble mb-0">
      <div class="message-content"><%= @message.content %></div>
      <div class="message-date text-end">Il y a <%= time_ago_in_words(@message.created_at) %></div>
    </div>
  </div>
</div>

<!-- Suggestion de rÃ©ponse (toujours visible) -->
<div class="msg-bubble-pink mb-3">
  <%= render "messages/ai_suggestion", message: @message, conversation: @conversation %>
</div>

<script>
function toggleBlock(blockId, iconId) {
  const block = document.getElementById(blockId);
  const icon = document.getElementById(iconId);

  if (!block || !icon) return;

  const isOpen = block.classList.contains("open");

  if (isOpen) {
    block.classList.remove("open");
    icon.innerHTML = "ðŸ”»"
  } else {
    block.classList.add("open");
    icon.innerHTML = "ðŸ”º"
  }
}
</script>
