<h1>Mon Dashboard</h1>

<div style="display: flex; align-items: center; gap: 20px;">
  <div style="width: 300px; background: #eee; border-radius: 10px; overflow: hidden;">
    <div style="width: <%= @user.xp_percent %>%; background: #4caf50; height: 24px;"></div>
  </div>
  <span style="font-weight: bold;">
    <%= @user.xp_progress %> / <%= @user.xp_for_next_level %> XP
  </span>
  <span style="font-weight: bold; font-size: 1.2em;">
    Niveau : <%= @user.level %>
  </span>
</div>

<h2>Mes badges :</h2>
<ul>
  <% @badges.each do |badge| %>
    <li>
      <strong><%= badge.title %></strong>
      <br>
      <em>Condition : <%= badge.condition_description %></em>
    </li>
  <% end %>
</ul>

<%= link_to "Messages à répondre", awaiting_answer_messages_path, class: "nav-link" %>

<% awaiting_messages = current_user.messages.where(status: :draft_by_ai, dismissed: [false, nil]) %>
<% if awaiting_messages.any? %>
  <h3>Messages en attente de réponse :</h3>
  <ul>
    <% awaiting_messages.each do |message| %>
      <% next if message.nil? || message.id.nil? %>
      <li>
        <strong>De :</strong> <%= message.contact.name %><br>
        <strong>Message :</strong> <%= message.content %><br>
        <strong>Suggestion :</strong> <%= message.ai_draft.presence || "Aucune suggestion disponible." %>
        <%= link_to "Répondre", edit_message_path(message), class: "btn btn-primary btn-sm ms-2" %>
        <%= button_to dismiss_suggestion_message_path(message), method: :patch, class: "btn btn-link btn-sm p-0", title: "Ignorer cette suggestion" do %>
          <i class="bi bi-x-lg"></i>
        <% end %>
      </li>
    <% end %>
  </ul>
<% end %>
