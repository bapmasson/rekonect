<div class="chat-container">
  <% if @pending_levelup %>
  <div id="pending-levelup" data-level="<%= @pending_levelup %>"></div>
  <% end %>
  <% if @pending_xp_popup %>
  <div id="pending-xp-popup"
       data-xp-percent="<%= @pending_xp_popup['xp_percent'] %>"
       data-xp-progress="<%= @pending_xp_popup['xp_progress'] %>"
       data-xp-total="<%= @pending_xp_popup['xp_total'] %>"
       data-level="<%= @pending_xp_popup['level'] %>"></div>
  <% end %>
  <h2 class="conversation-header">Conversation avec <strong><%= @conversation.contact.name %></strong></h2>
  <hr>
  <%= turbo_stream_from "conversation_#{@conversation.id}_messages" %>
  <div class="sms-chat" id="messages">
    <% @messages.each do |message| %>
      <%= render 'messages/message', message: message %>
    <% end %>
  </div>
  <div class="chat-form-row">
    <%= form_with model: Message.new,
              url: messages_path,
              data: {
                controller: "send-message reset-form",
                send_message_target: "form",
                action: "submit->send-message#submit turbo:submit-end->reset-form#reset"
              },
              html: { class: "chat-form" } do |f| %>
      <%= f.hidden_field :conversation_id, value: @conversation.id %>
      <%= f.hidden_field :contact_id, value: @conversation.contact_id %>
      <%= f.text_area :content, placeholder: "Message", class: "chat-input" %>
      <%= f.button :submit, class: "chat-send-btn", "aria-label": "Envoyer le message" do %>
        <i class="fa-solid fa-paper-plane"></i>
      <% end %>
    <% end %>
  </div>
</div>
